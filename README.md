# Reveal Deleted FB Messages

[BÃ i viáº¿t Facebook](https://www.facebook.com/groups/j2team.community/posts/1650049605327153/)

Má»™t extension nho nhá», giÃºp má»i ngÆ°á»i xem láº¡i nhá»¯ng tin nháº¯n Ä‘Ã£ bá»‹ Ä‘á»‘i phÆ°Æ¡ng xÃ³a trong fb messenger.

- Há»— trá»£ 2 trang web [facebook.com](https://www.facebook.com) vÃ  [messenger.com](https://www.facebook.com)

- Há»— trá»£ xem cáº£ link *HÃ¬nh áº¢nh* Ä‘Ã£ gá»¡

- Hiá»‡n táº¡i chá»‰ hiá»ƒn thá»‹ tin nháº¯n bá»‹ xÃ³a trong **console** cá»§a trÃ¬nh duyá»‡t

- Extension Ä‘ang trong giai Ä‘oáº¡n phÃ¡t triá»ƒn, cÃ²n nhiá»u lá»—i váº·t

- Hiá»‡n chÆ°a up lÃªn store (máº¥t 5$ Ã¡ :)) ) Khi nÃ o hoÃ n thiá»‡n hÆ¡n, náº¿u cÃ³ tiá»n sáº½ up lÃªn cho má»i ngÆ°á»i dá»… xÃ i :)

### Ã tÆ°á»Ÿng vÃ  Tham kháº£o code tá»« [KB2A Tool](https://kb2atool.com/)


---


## Tá»± táº¡o 1 extension xem láº¡i tin nháº¯n bá»‹ gá»¡ trÃªn fb messenger

ChÃ o má»i ngÆ°á»i, láº¡i lÃ  mÃ¬nh Ä‘Ã¢y.

HÃ´m qua lÆ°á»›t fb tháº¥y [bÃ i viáº¿t](https://www.facebook.com/KB2A.Team/posts/344823077177578) (Ä‘Ã£ cÅ©) thÃ´ng bÃ¡o ra phiÃªn báº£n má»›i cá»§a [KB2A Tool](https://kb2atool.com/). CÅ©ng nghe danh lÃ¢u nÃªn hÃ o há»©ng vÃ´ táº£i vá» xÃ i thá»­, má»›i tháº¥y extension nÃ y nÃ³ náº·ng **hÆ¡n trÄƒm MB** áº¡ ğŸ˜¢ KhÃ´ng hiá»ƒu code gÃ¬ mÃ  code náº·ng tháº¿, sá»± tÃ² mÃ² nÃ³ ná»•i lÃªn, tháº¿ lÃ  vÃ o xem code, xem nÃ³ hoáº¡t Ä‘á»™ng tháº¿ nÃ oâ€¦

Sau vÃ i Ä‘Æ°á»ng google (*gáº§n chá»¥c tiáº¿ng*), cuá»‘i cÃ¹ng mÃ¬nh Ä‘Ã£ hiá»ƒu pháº§n nÃ o cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a chá»©c nÄƒng xem tin nháº¯n Ä‘Ã£ gá»¡ trÃªn fb rá»“i. MÃ  cÃ¡i gÃ¬ hay vá»›i láº¡ thÃ¬ láº¡ muá»‘n chia sáº» vá»›i má»i ngÆ°á»i ğŸ˜

Source code cá»§a extension KB2A Tool thÃ¬ cháº¯c cháº¯n lÃ  máº¥y báº¡n dev trong team Ä‘Ã³ Ä‘Ã£ nÃ©n háº¿t rá»“i, nÃªn viá»‡c tÃ¬m hiá»ƒu code má»›i máº¥t nhiá»u thá»i gian nhÆ° váº­y. DÆ°á»›i Ä‘Ã¢y mÃ¬nh sáº½ nÃ³i tá»•ng quan vá» cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a extension vÃ  cÃ¡ch tÃ¬m hiá»ƒu, cÃ¡ch lÃ m tá»«ng bÆ°á»›c nhÃ©.

P/s: BÃ i viáº¿t nÃ y mÃ¬nh viáº¿t dá»±a trÃªn tinh tháº§n chia sáº» kiáº¿n thá»©c, chá»© mÃ¬nh khÃ´ng quáº£ng cÃ¡o hay chÃª bai gÃ¬ extension KB2ATool nha. Náº¿u thÃ­ch má»i ngÆ°á»i cÃ³ thá»ƒ táº£i vá» xÃ i á»§ng há»™ máº¥y báº¡n áº¥y nha, tool Ä‘Ã³ cÃ³ nhiá»u chá»©c nÄƒng láº¯m khÃ´ng chá»‰ má»—i xem tin nháº¯n Ä‘Ã£ gá»¡ Ä‘Ã¢u, vÃ  cÅ©ng cÃ³ giao diá»‡n Ä‘áº¹p ná»¯a. â¤ï¸


## OK LETâ€™S GO.

### SÆ¡ lÆ°á»£c cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a extension

1. LÆ°u háº¿t tin nháº¯n
MÃ¬nh sáº½ táº¡o 1 script, **chÃ¨n script** nÃ³ vÃ o trang facebook, script sáº½ **láº¯ng nghe má»i sá»± kiá»‡n** gá»«i/nháº­n tin nháº¯n, vÃ  **lÆ°u láº¡i ná»™i dung tin nháº¯n kÃ¨m theo id** cá»§a tin nháº¯n Ä‘Ã³. 

2. Kiá»ƒm tra tin nháº¯n cÅ©
KÃ¨m theo Ä‘Ã³, má»—i khi cÃ³ sá»± kiá»‡n tin nháº¯n má»›i, mÃ¬nh sáº½ **kiá»ƒm tra** xem trong danh sÃ¡ch Ä‘Ã£ lÆ°u cÃ³ tháº±ng nÃ o **giá»‘ng id** vá»›i sá»± kiá»‡n má»›i nÃ y khÃ´ng. Náº¿u cÃ³ thÃ¬ (ráº¥t cÃ³ thá»ƒ) Ä‘Ã¢y lÃ  sá»± kiá»‡n thu há»“i tin nháº¯n. => **XUáº¤T RA TIN NHáº®N ÄÆ¯á»¢C THU Há»’I**

Äá»ƒ hiá»ƒu chi tiáº¿t cÃ¡ch lÃ m, má»i ngÆ°á»i Ä‘á»c tiáº¿p nhÃ© â¤ï¸

## CÃ¡ch hoáº¡t Ä‘á»™ng cá»§a tin nháº¯n trong fb:

Äá»ƒ cÃ³ thá»ƒ gá»­i nháº­n tin nháº¯n trong thá»i gian thá»±c, FB khÃ´ng dÃ¹ng nhá»¯ng loáº¡i request GET PUT bÃ¬nh thÆ°á»ng nhÆ° fetch, ajax, axios, â€¦ MÃ  nÃ³ dÃ¹ng 1 cáº¥u trÃºc khÃ¡c, Ä‘Ã³ lÃ  **WebSocket** ([lÃ  gÃ¬?](https://topdev.vn/blog/socket-la-gi-websocket-la-gi/)), cung cáº¥p kháº£ nÄƒng **giao tiáº¿p thá»i gian thá»±c** giá»¯a client vÃ  server, vÃ  cÃ³ thá»ƒ lÃ  giá»¯a cÃ¡c client vá»›i nhau ná»¯a..

Náº¿u má»i ngÆ°á»i vÃ o **devtool** cá»§a trÃ¬nh duyá»‡t, vÃ o tab **Network** vÃ  lá»c request theo **WS** (websocket) thÃ¬ sáº½ tháº¥y Ä‘Æ°á»£c nhá»¯ng káº¿t ná»‘i websocket Ä‘Æ°á»£c dÃ¹ng bá»Ÿi FB. FB cÃ³ nhiá»u káº¿t ná»‘i websocket, trong Ä‘Ã³ tháº±ng dÃ nh cho tin nháº¯n cÃ³ tÃªn má»Ÿ Ä‘áº§u lÃ  **chat?region=â€¦.**. Báº¥m vÃ o ta sáº½ tháº¥y Ä‘Æ°á»£c má»i **luá»“ng dá»¯ liá»‡u tá»›i vÃ  Ä‘i** trong káº¿t ná»‘i websocket áº¥y.


## PhÃ¢n tÃ­ch dá»¯ liá»‡u tin nháº¯n

CÃ³ ráº¥t **nhiá»u luá»“ng dá»¯ liá»‡u** tá»›i vÃ  Ä‘i trong websocket chat nÃ y, náº¿u chÃºng ta thá»­ gá»­i 1 tin cho ngÆ°á»i khÃ¡c, nÃ³ sáº½ táº¡o 1 luá»“ng gá»­i Ä‘i, cÃ²n ngÆ°á»i khÃ¡c gá»­i cho mÃ¬nh, sáº½ cÃ³ 1 luá»“ng gá»­i vá».

Dá»¯ liá»‡u trong má»—i luá»“ng máº·c Ä‘á»‹nh hiá»ƒn thá»‹ dÆ°á»›i dáº¡ng **base64**, chÃºng lÃ  cÃ³ thá»ƒ chuyá»ƒn vá» **utf8** Ä‘á»ƒ dá»… Ä‘á»c hÆ¡n (tháº¥y nÃ³ giá»‘ng chuá»—i json hÆ¡n thÃ´i chá»© váº«n khÃ³ Ä‘á»c láº¯m ğŸ˜‚).  

Náº¿u tÃ¬m ká»¹ chÃºng ta sáº½ tháº¥y Ä‘Æ°á»£c ná»™i dung tin nháº¯n, vÃ  tháº­t may lÃ  **khÃ´ng bá»‹ mÃ£ hÃ³a** gÃ¬ khÃ¡c ná»¯a cáº£ ğŸ¥¸. OKE tiáº¿p theo Ä‘á»ƒ cho tiá»‡n thÃ¬ ta táº¡o 1 regex giÃºp ta láº¥y Ä‘Æ°á»£c Ä‘oáº¡n tin nháº¯n Ä‘Ã³ ra khá»i chuá»—i dá»¯ liá»‡u, mÃ¬nh dÃ¹ng web [regexr.com](https://regexr.com/) Ä‘á»ƒ táº¡o regex cho láº¹.

**~ 2 thousand years later ....** 

Pháº£i Ä‘i há»c láº¡i khÃ³a regex má»›i Ä‘Æ°á»£c ğŸ˜¢ğŸ˜¢ğŸ˜¢

**YAY** Ä‘Ã£ láº¥y Ä‘Æ°á»£c ná»™i dung tin nháº¯n ra khá»i luá»“ng dá»¯ liá»‡u rá»“i. Giá» Ä‘á»ƒ má»i thá»© Ä‘Æ°á»£c tá»± Ä‘á»™ng, hÃ£y **táº¡o extension**.


## Táº¡o extension

MÃ¬nh tÃ¬m hiá»ƒu cÃ¡ch lÃ m extension á»Ÿ [topdev](https://topdev.vn/blog/cach-build-chrome-extension/) káº¿t há»£p vá»›i ngáº«m code cá»§a KB2A Tool.

Váº¥n Ä‘á» chÃ­nh bÃ¢y giá» Ä‘Ã³ lÃ  lÃ m sao Ä‘á»ƒ cÃ³ thá»ƒ **láº¯ng nghe websocket** cá»§a fb. Má»—i biáº¿n websocket Ä‘Æ°á»£c táº¡o ra sáº½ lÃ  1 biáº¿n local riÃªng biá»‡t, khÃ´ng pháº£i biáº¿n toÃ n cá»¥c, **khÃ´ng thá»ƒ truy cáº­p Ä‘Æ°á»£c tá»« bÃªn ngoÃ i**.

Sau khi tu luyá»‡n báº±ng source code KB2A Tool, thÃ¬ mÃ¬nh Ä‘Ã£ tÃ¬m ra chÃ¢n lÃ½. Máº¥y báº¡n áº¥y táº¡o 1 Ä‘oáº¡n **script**, vÃ  cho nÃ³ **cháº¡y trÆ°á»›c** khi trang fb cháº¡y (run at document_start). 
Äoáº¡n script nÃ y sáº½ táº¡o ra 1 biáº¿n window.WebSocket **GIáº¢**, trong Ä‘Ã³ **chÃ¨n code láº¯ng nghe sá»± kiá»‡n**. 

Khi trang facebook báº¯t Ä‘áº§u cháº¡y, nÃ³ sáº½ **dÃ¹ng tháº±ng GIáº¢** nÃ y Ä‘á»ƒ táº¡o biáº¿n websocket local cho riÃªng nÃ³ Ä‘á»ƒ dÃ¹ng. NhÆ°ng do Ä‘Ã£ bá»‹ **LÃ€M GIáº¢** tá»« trÆ°á»›c, nÃªn trong biáº¿n local Ä‘Ã³ Ä‘Ã£ cÃ³ sáºµn code láº¯ng nghe sá»± kiá»‡n cá»§a ta. **BÃ™MMM** ğŸ˜‚ğŸ˜‚ğŸ¤¯ğŸ¤¯

Váº­y lÃ  má»i Ã½ tÆ°á»Ÿng Ä‘Ã£ hoÃ n thÃ nh. MÃ¬nh Ä‘Ã£ thá»±c hiá»‡n vÃ  chia sáº» source code vá»›i má»i ngÆ°á»i táº¡i [github](https://github.com/HoangTran0410/RevealDeletedFBMessages)

p/s: MÃ¬nh sáº½ thÃªm áº£nh tá»«ng bÆ°á»›c vÃ  hÆ°á»›ng dáº«n chi tiáº¿t trong tá»«ng áº£nh nhÃ©..